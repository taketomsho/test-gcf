# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on PR
'on': pull_request

jobs:
  build_and_preview:
    permissions:
      contents: 'read'
      id-token: 'write'
      issues: write
    if: '${{ github.event.pull_request.head.repo.full_name == github.repository }}'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - id: 'auth'
        uses: 'google-github-actions/auth@v1'
        with:
          workload_identity_provider: 'projects/253126828940/locations/global/workloadIdentityPools/my-pool/providers/my-provider'
          service_account: 'my-service-account@tracky-333210.iam.gserviceaccount.com'

      - id: 'deploy'
        uses: 'google-github-actions/deploy-cloud-functions@v1'
        with:
          name: 'hellofunction-${{ github.event.pull_request.number }}'
          runtime: 'python310'
          entry_point: hello_http
          memory_mb: 512
          region: asia-northeast1
          labels:
            channel=preview
          source_dir: functions
          project_id: tracky-333210

      - name: 'Set up Cloud SDK'
        uses: 'google-github-actions/setup-gcloud@v1'

      - name: 'Add invoker'
        run: 'gcloud functions add-iam-policy-binding hellofunction-1 --member=allUsers --role=roles/cloudfunctions.invoker --region=asia-northeast1 --project=tracky-333210'

      # Example of using the output
      # - name: Add comment
      #   uses: peter-evans/create-or-update-comment@a35cf36e5301d70b76f316e867e7788a55a31dae
      #   with:
      #     issue-number: ${{ github.event.pull_request.number }}
      #     body: |
      #       Visit the preview URL for this PR : "${{ steps.deploy.outputs.url }}" This issue is available for anyone to work on. **Make sure to reference this issue in your pull request.** :sparkles: Thank you for your contribution! :sparkles: